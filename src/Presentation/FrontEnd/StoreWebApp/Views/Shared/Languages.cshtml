@using System.Globalization
@using VirtoCommerce.Foundation.AppConfig.Model
@{
    var tempValues = new RouteValueDictionary(ViewContext.RouteData.Values);
    foreach (var key in Request.QueryString.Keys.Cast<string>())
    {
        tempValues.Add(key, Request.QueryString[key]);
    }

    var store = StoreHelper.StoreClient.GetCurrentStore();
    if (store != null && store.Languages != null && store.Languages.Any())
    {
        var currentCulture = CultureInfo.CreateSpecificCulture(UICulture);
    <span>@("Language".Localize()): 
	       
        <span class="current">@currentCulture.NativeName.Substring(0, currentCulture.NativeName.IndexOf('(')).Trim()</span>
    </span>
    <ul>
        @foreach (var lang in store.Languages)
        {
            var culture = CultureInfo.CreateSpecificCulture(lang.LanguageCode);
            tempValues["lang"] = culture.Name;
            tempValues["store"] = SettingsHelper.SeoEncode(StoreHelper.CustomerSession.StoreId, SeoUrlKeywordTypes.Store, culture.Name);
            if (tempValues.ContainsKey("category") && tempValues["category"] as string != null)
            {
                tempValues["category"] = SettingsHelper.SeoEncode(SettingsHelper.SeoDecode(tempValues["category"].ToString(), SeoUrlKeywordTypes.Category), SeoUrlKeywordTypes.Category, culture.Name);
            }
            
            var countryCode = culture.Name.Substring(culture.Name.IndexOf('-') + 1).ToLowerInvariant();
            var liClass = string.Equals(lang.LanguageCode, UICulture, StringComparison.InvariantCultureIgnoreCase) ? " selected" : "";
	  
            <li class="@liClass">
                <img src="~/Content/themes/default/images/blank.gif" class="flag flag-@countryCode" alt="@culture.NativeName">
                @Html.ActionLink(culture.NativeName.Substring(0, culture.NativeName.IndexOf('(')).Trim(), null, tempValues, new Dictionary<string, object>
                {
                    {"title", culture.NativeName}
                })
            </li>
        }
    </ul>
    }
}